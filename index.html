<head>
    <head>
        <meta name="description" content="A timing tool for Breath of the Wild Individual Level runs">
        <title> Breath of the Wild IL Timer</title>
        <meta name="Keywords" content="Individual Levels, Breath of the Wild, Komali, Timer">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="./favicon.ico" type="image/x-icon" />
        <link rel="stylesheet" href="./v2styles.css">
    </head>
</head>

<!--

   @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ #   % &@@@@@@@@@@@@@@@@@@@@@@@.(   (.@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#(     %(@@@@@@@@@@@@@@@@@@@@@@@ /   .*(@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@/%@@@/   /@@@@@@@@@@@@@@@@@@@@@@@@@@@///&@@/ /@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@,*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@,.&@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@,*@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@ &@@@@@@@@@@@@@@@@@@@@@@@@@@@@%(@@@@@@@@@@@@@@@@@@@@@@@@@@@@*.&@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@ %@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*  .@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ (@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@(/@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@      @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@(*@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@ &@@@@@@@@@@@@@@@&  (@@@@@@@@@@@       ,@@@@@@@@@@#   .@@@@@@@@@@@@@@@@ (@@@@@@@@@@@@@
@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@&     ,@@@@@@@, ,*****  @@@@@&.      /@@@@@@@@@@@@@@@@@.(@@@@@@@@@@@@
@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@&       ,#@@@@@@@@@@@@@@@@@@@@(      #@@@@@@@@@@@@@@@@@@*/@@@@@@@@@@@
@@@@@@@@@@@.@@@@@@@@@@@@@@@@@@@&   (@@@@@@@(            *&@@@@@@@( .@@@@@@@@@@@@@@@@@@@@.(@@@@@@@@@@
@@@@@@@@@@/*@@@@@@@@@@@@@@@@@@@@(@@@@@,      /* (/(( ,/(      #@@@@@@@@@@@@@@@@@@@@@@@@@@ &@@@@@@@@@
@@@@@@@@@@ &@@@@@@@@@@@@@/ @@@@@@@(    /&@(.&@@@%(((@@@& /@&*    *@@@@@@@(,@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@(/*./@@@@@@@@@@@@  .&&(.    (@@@@.*@@          &@% &@@@(     (&&(  /@@@@@@@@@@&.*(/,(@@@@@@@
@@@@@@,(     &.@@@@@@@@@@@*      (@@@@@@@&@@    /@@%    #@@@@@@@@@@.      #@@@@@@@@@@/(.    /*/@@@@@
@@@@@@ /     / @@@@@@@@@@@@@@@@(  #@@@@@%#@@    (@@#    (@@(@@@@@&  ,@@@@@@@@@@@@@@@@/%     /*(@@@@@
@@@@@@@(.##/ (@@@@@@@@@@@@@@@@@@@/  #@@@@ &@@*         (@@ &@@@%  .@@@@@@@@@@@@@@@@@@@@/*// (@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@(   (@@/ @@@@#(/(@@@& ,@@(   (@@@@@@@@@@@@@@@@@@@@@@@@*/@@@@@@@@@
@@@@@@@@@@.&@@@@@@@@@@@@@@@@@@@@@@@@@@&*   .//  .(((. (,    /%@@@@@@@@@@@@@@@@@@@@@@@@@@@.&@@@@@@@@@
@@@@@@@@@@&.@@@@@@@@@&@@@@@@@@@@@@@@@@@@@@@@%(*,    ,((%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@.(@@@@@@@@@@
@@@@@@@@@@@(*@&*.(#@@@*/@@@@@@@@@@@@@@@@@@@@@@@@/   @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*(@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@    #@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#(@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@( #@@@@@@@@@@@@@@@@@@@&    /@@@@@@@@@@@@@@%///(/@@@@@@@@@@@@ (@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@&  (@@@@@@@@@@@@@@@@,     %@@@@@@@@@@@@@/    ((@@@@@@@@@.*@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@%.%@@@%* #@@@@@@@@@@@#      ,@@@@@@@@@@@&.//,,,#@@@@@@@@/ /@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@&,..&@@@@@@@@@@@@(. %@@@@@@        (@@@@@@*.(%@@@@@@@@@@@@@@& (@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@/   (%@@@@@@@@@@@@@*@@@@@@@        (@@@@@@%*@@@@@@@@@@@@@@(*(@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@/((@@@@@@@@@@@@@@*@@@@@@@&        (@@@@@@@@*@@@@@@@@@@( (@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@(.*  @@@@@@@@@@      (@@@@@@@@@(,@@@@@(..(@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%/     *&@@@@@@@@@@&%@@@@@@@@@@@@@& / *(@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ (   / @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Just Looking under the hood? @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
  @@@@@@@@@@@@@@@@@@@@@@@ https://github.com/PrinceKomali/BotW-IL-Timer/ @@@@@@@@@@@@@@@@@@@@@@@@@



-->

<p id="ct">0</p>
<input type="file" id="file" accept=".mp4, .mov, .avi" style="visibility: hidden; width: 0; height: 0;">
<label for="file" class="fopen button">Open Run</label> 
<div class="seg"><input type="checkbox" id="segmentcheck"> Check this if timing a segment (e.g. BTT segment) </div>
<p class = "yt button" onclick = "load()">Open from Youtube</p><input type = "text" id = "url" placeholder="">
<video src="" oncontextmenu="return false;"></video>
<script>
    Object.defineProperty(HTMLMediaElement.prototype, 'playing', {
        get: function(){
            return !!(this.currentTime > 0 && !this.paused && !this.ended && this.readyState > 2);
        }
    })
    //shamelessly stolen from stackoverflow :) 


    let nd = 0;
    let st = 0;

    var vid = document.querySelector('video');
    function load() {
        var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    vid.src = this.responseText
                }
        };
        var vurl = document.getElementById("url");
        // console.log(vurl.value)
        // console.log("https://expressytdl.komali09.repl.co/dl?" + vurl.value)
        xhttp.open("GET", "https://expressytdl.komali09.repl.co/dl?url=" + vurl.value, true);
        xhttp.send();
    }
    let isLoaded = false;

    // function log(l) {
    //     document.querySelector(".log").innerText = "Log: " + l;
    // }
    // window.onload = () => {
    //     log("Page Loaded")
    // }
    var vidMouseDown = 0;
    vid.onmousedown = function() {
        ++vidMouseDown;
    }
    vid.onmouseup = function() {
        vidMouseDown = 0;
    }
    vid.onpause = function() {
        vid.currentTime = Math.floor(vid.currentTime * 30) / 30;
    }
    document.querySelector('input[type="file"]').addEventListener('change', function() {
        if (this.files && this.files[0]) {
            vid.src = URL.createObjectURL(this.files[0]);
            vid.addEventListener('loadeddata', function() {
                // log("Video Loaded");
                isLoaded = true;
                nd = 0;
                st = 0;
            }, false);
        }
    });

    function advance(f = 1)
    {
        if(!isLoaded) return;
        if(vid.currentTime + (f/30) >= 0) vid.currentTime += ( f/30 );
        else {
            vid.currentTime = 0;
        }
    }
    function play()
    {
        if(!isLoaded) return;
        vid.play();
    }
    function pause()
    {
        if(!isLoaded) return;
        vid.pause();
    }
    function setSt()
    {
        if(!isLoaded) return;
        st = vid.currentTime;
        if(nd == 0) nd = vid.currentTime;
    }
    function setNd()
    {
        if(!isLoaded) return;
        nd = vid.currentTime;
    }
    


    document.body.onkeydown = function(e) {
    if (e.keyCode == 39 && !e.shiftKey && !e.ctrlKey) {
      advance(1);
    }
    if (e.keyCode == 39 && e.shiftKey && !e.ctrlKey) {
      advance(15);
    }
    if (e.keyCode == 39 && e.ctrlKey) {
      advance(150);
    }
    if (e.keyCode == 37 && !e.shiftKey && !e.ctrlKey) {
      advance(-1);
    }
    if (e.keyCode == 37 && e.shiftKey && !e.ctrlKey) {
      advance(-15);
    }
    if (e.keyCode == 37 && e.ctrlKey) {
      advance(-150);
    }
    if (e.keyCode == 13){
        setSt();
    }
    if(e.keyCode == 8) {
        setNd();
    }
    if(e.keyCode == 8) {
        setNd();
    }
    if(e.keyCode == 32) {
        if(vid.playing) {
            vid.pause();
        }
        else {
            vid.play();
        }
    }
    
  }

    let segmentDur;
    let main = setInterval(() => {
        segmentDur = document.querySelector("#segmentcheck").checked == true ? 0 : (1/30);
        document.querySelector("#ct").innerText = "Current Timestamp: " + vid.currentTime.toFixed(3);
        document.querySelector(".FRAMECOUNT").innerText = ((nd-st) + segmentDur).toFixed(3);
        document.querySelector(".stnd").innerText = `Start: ${st.toFixed(3)}   |  End: ${nd.toFixed(3)}`

    }, 1);
</script>
<p class="button play" onclick="play()">Play Run</p>
<p class="button pause" onclick="pause(1)">Pause Run</p>
<p class="button f1" onclick="advance(1)">Frame Advance </p>
<p class="button fm1" onclick="advance(-1)">Frame Advance -1</p>
<p class="button f15" onclick="advance(15)">Advance 15f</p>
<p class="button fm15" onclick="advance(-15)">Go Back 15f</p>
<p class="button f5s" onclick="advance(150)">Advance 5s</p>
<p class="button fm5s" onclick="advance(-150)">Go Back 5s</p>
<p class="button tost" onclick="(() => vid.currentTime = 0)()">Jump to Start</p>
<p class="button tond" onclick="(() => vid.currentTime = vid.duration)()">Jump to End</p>
<p class="FRAMECOUNT">0.000</p>
<p class="stnd">Start: 0.000   |  End: 0.000</p>
<p class="button st" onclick="setSt()">Set Start Frame</p>
<p class="button nd" onclick="setNd()">Set End Frame</p>
<!-- <p class="log">a</p> -->
<div class="keybinds">Keyboard Commands: <br>
Frame Advance +/- 1f: Arrow Keys<br>
Frame Advance +/- 15f: Shift + Arrow Keys<br>
Frame Advance +/- 5s: Ctrl + Shift + Arrow Keys<br>
Set Start: Enter<br>
Set End: Backspace<br>
Pause/Play Run: Spacebar
</div>
<p class="v1">Looking for the old timer? Head on over to <a href = "https://princekomali.github.io/BotW-IL-Timer/v1">https://princekomali.github.io/BotW-IL-Timer/v1</a></p>
